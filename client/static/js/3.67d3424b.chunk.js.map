{"version":3,"sources":["Components/Admin/AdminPage/AdminNav/AdminNav.jsx","Components/Loading.jsx","Components/Admin/AdminPage/AdminProducts/AdminProducts.jsx","Components/Admin/AdminPage/AdminPage.jsx"],"names":["AdminNav","props","matchUrl","linkStyles","className","activeClassName","react_default","a","createElement","react_router_dom","Object","assign","to","Loading","_ref","children","placeholder","loaded","AdminProducts","state","products","values","oldValues","loading","onChange","e","target","value","type","checked","name","path","split","pop","deepCopy","_this","reduce","el","key","parseInt","fixMinMax","setState","newValues","changedValues","objDiff","product","width","height","validateMinMax","saveValues","fields","axios","put","then","data","setValues","catch","err","_this2","this","get","_ref2","history","push","_this3","map","getValues","console","log","_iteratorNormalCompletion","_didIteratorError","_iteratorError","undefined","_step","_iterator","Symbol","iterator","next","done","val","product_key","field","getSelectValues","getRangeValues","return","min","max","selectValues","price","oldVal","Math","Products","onClick","Component","_ref3","Fragment","ProductsGroup","_ref4","label","ProductsInputs","group","concat","_ref5","ProductsRangeInput","inputs","text","_ref6","rest","objectWithoutProperties","RangeInput","AdminPage","match","url","AdminNav_AdminNav","react_router","component","__webpack_require__","d","__webpack_exports__","AdminPage_AdminPage"],"mappings":"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","file":"static/js/3.67d3424b.chunk.js","sourcesContent":["import React from 'react';\r\nimport { NavLink } from 'react-router-dom';\r\n\r\nimport './AdminNav.css';\r\n\r\nexport default function AdminNav(props) {\r\n  const matchUrl = props.matchUrl;\r\n  const linkStyles = {\r\n    className: 'admin-nav__link',\r\n    activeClassName: 'admin-nav__link--active',\r\n  };\r\n\r\n  return (\r\n    <nav className=\"admin-nav\">\r\n      <NavLink {...linkStyles} to={matchUrl + '/orders'}>\r\n        Список заказов\r\n      </NavLink>\r\n      <NavLink {...linkStyles} to={matchUrl + '/products'}>\r\n        Товары\r\n      </NavLink>\r\n    </nav>\r\n  );\r\n}\r\n","export default function Loading({ children, placeholder, loaded }) {\r\n  return loaded ? children : placeholder;\r\n}","import React, { Component } from 'react';\r\nimport axios from 'axios';\r\n\r\nimport './AdminProducts.css';\r\nimport RangeInput from '../../../RangeInput/RangeInput';\r\nimport Loading from '../../../Loading';\r\n\r\nimport { deepCopy, objDiff } from 'lib';\r\n\r\nexport default class AdminProducts extends Component {\r\n  state = {\r\n    products: null,\r\n    values: null,\r\n    oldValues: null,\r\n    loading: true,\r\n  };\r\n\r\n  onChange = e => {\r\n    const target = e.target;\r\n    const value = target.type === 'checkbox' ? target.checked : target.value;\r\n    let name = target.name;\r\n\r\n    const path = name.split('-');\r\n    name = path.pop();\r\n\r\n    const values = deepCopy(this.state.values);\r\n\r\n    path.reduce((el, key) => el[key], values)[name] = parseInt(value);\r\n\r\n    this.fixMinMax(values);\r\n\r\n    this.setState({ values });\r\n  };\r\n\r\n  componentDidMount() {\r\n    axios\r\n      .get(`/api/products?extended=true`)\r\n      .then(({ data }) => this.setValues(data))\r\n      .catch(err => {\r\n        this.props.history.push('/admin');\r\n      });\r\n  }\r\n\r\n  setValues(data) {\r\n    data = data.map(el => {\r\n      delete el.fields.type;\r\n      return el;\r\n    });\r\n    const values = this.getValues(data);\r\n    const oldValues = deepCopy(values);\r\n\r\n    this.setState({ products: data, values, oldValues, loading: false }, () =>\r\n      console.log(this.state),\r\n    );\r\n  }\r\n\r\n  getValues(products) {\r\n    const values = {};\r\n\r\n    for (let val of products) {\r\n      const fields = val.fields;\r\n      const product = {};\r\n      values[val.product_key] = product;\r\n\r\n      for (let key in fields) {\r\n        const field = fields[key];\r\n        const productValues = {};\r\n        product[key] = productValues;\r\n\r\n        if (field.type === 'range') {\r\n          product[key] = this.getRangeValues(field);\r\n          continue;\r\n        }\r\n\r\n        if (field.type === 'select' || field.type === 'select-window') {\r\n          product[key] = this.getSelectValues(field);\r\n          continue;\r\n        }\r\n      }\r\n    }\r\n\r\n    return values;\r\n  }\r\n\r\n  getRangeValues(field) {\r\n    return {\r\n      min: field.min,\r\n      max: field.max,\r\n    };\r\n  }\r\n\r\n  getSelectValues(field) {\r\n    const values = field.values;\r\n    const selectValues = {};\r\n\r\n    for (let key in values) {\r\n      if (values[key].price === undefined) continue;\r\n      selectValues[key] = {};\r\n      selectValues[key].price = values[key].price;\r\n    }\r\n\r\n    return {\r\n      values: selectValues,\r\n    };\r\n  }\r\n\r\n  fixMinMax = newValues => {\r\n    const { values } = this.state;\r\n    const changedValues = objDiff(values, newValues);\r\n\r\n    for (let key in changedValues) {\r\n      let product = changedValues[key];\r\n\r\n      if (!product.width && !product.height) continue;\r\n\r\n      if (product.width) {\r\n        this.validateMinMax(product.width, values[key].width);\r\n        newValues[key].width = product.width;\r\n      }\r\n      if (product.height) {\r\n        this.validateMinMax(product.height, values[key].height);\r\n        newValues[key].height = product.height;\r\n      }\r\n    }\r\n  };\r\n\r\n  validateMinMax(val, oldVal) {\r\n    if (val.min !== undefined) {\r\n      val.max = Math.max(val.min, oldVal.max);\r\n      return;\r\n    }\r\n\r\n    if (val.max !== undefined) {\r\n      val.min = Math.min(oldVal.min, val.max);\r\n      return;\r\n    }\r\n  }\r\n\r\n  saveValues = () => {\r\n    const changedValues = objDiff(this.state.oldValues, this.state.values);\r\n    if (!changedValues) return;\r\n    this.setState({ loading: true });\r\n\r\n    const newValues = {};\r\n    for (let key in changedValues) {\r\n      newValues[key] = {};\r\n      newValues[key].fields = changedValues[key];\r\n    }\r\n\r\n    axios\r\n      .put(`/api/products`, newValues)\r\n      .then(({ data }) => {\r\n        this.setValues(data);\r\n      })\r\n      .catch(err => {\r\n        this.setState({ loading: false });\r\n      });\r\n  };\r\n\r\n  render() {\r\n    return (\r\n      <div className=\"products\">\r\n        <h1 className=\"products__heading\">Товары</h1>\r\n\r\n        <Loading loaded={!this.state.loading} placeholder=\"Загрузка...\">\r\n          <Products\r\n            products={this.state.products}\r\n            values={this.state.values}\r\n            onChange={this.onChange}\r\n          />\r\n          <button className=\"products__save\" onClick={this.saveValues}>\r\n            Сохранить\r\n          </button>\r\n        </Loading>\r\n      </div>\r\n    );\r\n  }\r\n}\r\n\r\nfunction Products({ products, values, onChange }) {\r\n  return products.map(product => {\r\n    const key = product.product_key;\r\n    return (\r\n      <React.Fragment key={key}>\r\n        <section className=\"product\">\r\n          <h2 className=\"product__name\">{product.name}</h2>\r\n          <ProductsGroup\r\n            values={values[key]}\r\n            onChange={onChange}\r\n            product={product.fields}\r\n            name={key}\r\n          />\r\n        </section>\r\n        <hr />\r\n      </React.Fragment>\r\n    );\r\n  });\r\n}\r\n\r\nfunction ProductsGroup({ product, values, onChange, name }) {\r\n  const fields = [];\r\n\r\n  for (let key in product) {\r\n    fields.push(\r\n      <div className=\"product-group\" key={key}>\r\n        <h3 className=\"product-group__name\">{product[key].label}</h3>\r\n        <div className=\"product-group__row\">\r\n          <ProductsInputs\r\n            group={product[key]}\r\n            values={values[key]}\r\n            onChange={onChange}\r\n            name={`${name}-${key}`}\r\n          />\r\n        </div>\r\n      </div>,\r\n    );\r\n  }\r\n\r\n  return fields;\r\n}\r\n\r\nfunction ProductsInputs({ group, values, onChange, name }) {\r\n  if (group.type === 'range') {\r\n    return [\r\n      <ProductsRangeInput\r\n        label=\"Минимальная\"\r\n        name={`${name}-min`}\r\n        value={values.min}\r\n        min={500}\r\n        onChange={onChange}\r\n        key={`min-${values.min}`}\r\n      />,\r\n      <ProductsRangeInput\r\n        label=\"Максимальная\"\r\n        name={`${name}-max`}\r\n        value={values.max}\r\n        min={500}\r\n        onChange={onChange}\r\n        key={`max-${values.max}`}\r\n      />,\r\n    ];\r\n  }\r\n\r\n  if (group.type === 'select' || group.type === 'select-window') {\r\n    const inputs = [];\r\n\r\n    for (let key in group.values) {\r\n      const val = group.values[key];\r\n      if (!val.price) continue;\r\n\r\n      inputs.push(\r\n        <ProductsRangeInput\r\n          key={key}\r\n          label={val.text}\r\n          name={`${name}-values-${key}-price`}\r\n          onChange={onChange}\r\n          value={values.values[key].price}\r\n        />,\r\n      );\r\n    }\r\n\r\n    return inputs;\r\n  }\r\n\r\n  return null;\r\n}\r\n\r\nfunction ProductsRangeInput({ label, ...rest }) {\r\n  return (\r\n    <label className=\"product-group__input\">\r\n      {label}\r\n      <RangeInput min={1} {...rest} />\r\n    </label>\r\n  );\r\n}\r\n","import React from 'react';\r\nimport { Route, Switch, Redirect } from 'react-router-dom';\r\nimport './AdminPage.css';\r\n\r\nimport AdminNav from './AdminNav/AdminNav';\r\nimport AdminProducts from './AdminProducts/AdminProducts';\r\n\r\nexport default function AdminPage(props) {\r\n  const matchUrl = props.match.url;\r\n\r\n  return (\r\n    <div className=\"admin__container\">\r\n      <aside className=\"admin__sidebar\">\r\n        <AdminNav matchUrl={matchUrl}/>\r\n      </aside>\r\n      <main className=\"admin__main-container\">\r\n        <Switch>\r\n          <Route path={matchUrl + '/products'} component={AdminProducts} />\r\n          <Route path={matchUrl + '/orders'} component={() => 'Заказы'} />\r\n          <Redirect to={matchUrl + '/orders'} />\r\n        </Switch>\r\n      </main>\r\n    </div>\r\n  );\r\n}\r\n"],"sourceRoot":""}